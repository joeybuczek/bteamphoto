<div class="row">
  <div class="small-10 small-centered large-6 large-uncentered columns">

    <p class="large-text">Add Client</p>

    <%= form_for @user do |f| %>

      <span>Client Name:</span>
      <%= f.text_field :client_name %>
        
      <span>Email:</span>
      <%= f.email_field :email %>

      <span>Primary contact (or Bride):</span>
      <%= f.text_field :name_primary %>

    <%= f.submit 'Add Client', class: 'button small radius secondary' %>

    <% end %>

    <br/>
    <p class="large-text">Client Index</p>

    <% @users.each do |user| %>
    
      <% unless user.admin? %>
        <table class="table-width-100">
          <thead>
            <tr>
              <th class="table-header-width-100 clearfix">    
                <%= link_to 'Delete', user, method: :delete, data: { confirm: "Are you sure you want to delete client '#{user.client_name}'?" }, class: 'button tiny radius secondary right clear-margin clear-padding' %>
                <span><%= user.client_name %></span><br/>
                <span><%= user.email %></span>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <% unless user.invitations.last.nil? %>
                  <span class="subdued-text">Token: <%= user.invitations.last.token %></span>
                <% else %>
                  <%= link_to 'Send Invitation', send_invitation_path(user), data: { confirm: 'Are you sure you are ready to send the invitation?'} %>
                <% end %>
                <br/>
                <%= link_to "Edit Client Details", user %>    
              </td>
            </tr>
            <tr>
              <td>
                <% if user.wedding.nil? %>
                  <%= link_to 'Add Wedding', add_wedding_path(user) %>
                <% else %>
                  <span><%= link_to 'View/Edit Wedding Details', user.wedding %></span><br/>
                  <% unless user.wedding.invoices.nil? %>
                    <!-- Wedding Invoices -->
                    <br/><span><strong>Wedding Invoices:</strong></span><br/>
                    <% user.wedding.invoices.each do |invoice| %>
                      <%= link_to "#{invoice.description}", invoice %>
                      <!-- Determine if paid or balance due -->
                      <span class="label round info nudge-up-2"><%= invoice.balance > 0 ? "#{humanized_money_with_symbol(invoice.balance)}" : "Paid" %></span><br/>
                    <% end %>
                    <!-- Wedding Web Galleries -->
                    <br/><span><strong>Web Galleries:</strong></span><br/>
                    <% unless user.webgalleries.nil? %>
                      <% user.webgalleries.each do |webgallery| %>
                        <%= link_to "#{webgallery.url}", webgallery.url %>
                        <%= link_to "X", webgallery, method: :delete, class: 'label round nudge-up-2 secondary', data: { confirm: "Are you sure you want to delete this web gallery?" } %>
                      <% end %>
                    <% end %>
                    <!-- Add new web gallery -->
                    <%= form_for @webgallery do |f| %>
                      <br/><span>URL:</span>
                      <%= f.text_field :url %>
                      <%= f.hidden_field :user, value: user.id %>
                      <%= f.hidden_field :genre, value: 'wedding' %>
                      <%= f.submit "Add Web Gallery", class: 'button tiny radius secondary' %>
                    <% end %>
                  <% end %>
                <% end %>   
              </td>
            </tr>
          </tbody>
        </table>
      <% end %>
    
    <% end %>
    
  </div>
</div>